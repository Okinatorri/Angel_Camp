<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


<link href="https://fonts.googleapis.com/css2?family=Advent+Pro:wght@400;600;700&display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/css2?family=Roboto+Serif&display=swap" rel="stylesheet">


  <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='koleso.css') }}">
</head>
<body>
    <img class= 'backgraund2' src="{{ url_for('static', filename='image/ram.png') }}" alt="image" />
<img id="wheel" class="backgraund3" src="{{ url_for('static', filename='image/колесо31.svg') }}" alt="wheel" />

<img class= 'backgraund1' src="{{ url_for('static', filename='image/bg_kol.svg') }}" alt="image" />

    <div class="header">
        <h1 class="name">{{ username }}</h1>

            <a href="{{ url_for('login') }}" class="login-button">
            <img class="login-img" src="{{ url_for('static', filename='image/login1.png') }}" alt="image" />
            </a>

      <img class= 'logo' src="{{ url_for('static', filename='image/ANGELlogo1w13.png') }}" alt="image" />
    </div>


<div class="comand">
  <h1 class="naz">{{ team_data['1']['name'] }}</h1>
  <h1 class="bal">{{ team_data['1']['score'] }} балів</h1>
</div>




<script>
const wheel = document.querySelector('.backgraund3');
let currentRotation = 0;
let spinning = false;

// Сообщения по сектору
const prizeMessages = {
  1: "Участь у розігроші від Саши!",
  7: "5 хвилин можно віддихнути на зарядці )",
  6: "Ви вийграли +1 балл!",
  5: "Можешь дити 5 Соні )",
  4: "Ти вийграв цукерку!(підійди до наставника, щоб отримати)",
  3: "Можешь зробити селфі з Яником",
  2: "Ти вийграв вірш із Біблії!"
};

// Сообщение
const resultBox = document.createElement('div');
resultBox.style.position = 'fixed';
resultBox.style.top = '50%';
resultBox.style.left = '50%';
resultBox.style.transform = 'translate(-50%, -50%)';
resultBox.style.padding = '20px';
resultBox.style.backgroundColor = 'white';
resultBox.style.border = '2px solid black';
resultBox.style.borderRadius = '10px';
resultBox.style.fontSize = '18px';
resultBox.style.display = 'none';
resultBox.style.zIndex = '9999';
document.body.appendChild(resultBox);

wheel.addEventListener('click', async () => {
  if (spinning) return;
  spinning = true;

  try {
    const response = await fetch('/spin');
    const data = await response.json();

    if (data.error) {
      alert(data.error);
      spinning = false;
      return;
    }

    const sector = data.result;

    const sectorCount = 7;
    const sectorAngle = 360 / sectorCount;
    const randomOffset = sectorAngle / 2;
    const fullSpins = 3 * 360;
    const targetAngle = sectorAngle * (sector - 1) + randomOffset;
    currentRotation += fullSpins + targetAngle;

    wheel.style.transition = 'transform 3s ease-out';
    wheel.style.transform = `rotate(${currentRotation}deg)`;

    setTimeout(() => {
      if (sector === 2 && data.message) {
        // если выпал стих
        showBibleVersePopup(data.message);
      } else {
        resultBox.innerText = prizeMessages[sector] || "Приз неизвестен";
        resultBox.style.display = 'block';

        setTimeout(() => {
          resultBox.style.display = 'none';
        }, 3000);
      }
      spinning = false;
    }, 3100);


  } catch (error) {
    console.error('Ошибка:', error);
    spinning = false;
  }
});

function showBibleVersePopup(message) {
  const popup = document.createElement('div');
  popup.style.position = 'fixed';
  popup.style.top = '0';
  popup.style.left = '0';
  popup.style.width = '100vw';
  popup.style.height = '100vh';
  popup.style.background = 'rgba(0, 0, 0, 0.8)';
  popup.style.display = 'flex';
  popup.style.alignItems = 'center';
  popup.style.justifyContent = 'center';
  popup.style.zIndex = '9999';
  popup.style.cursor = 'pointer';

  const inner = document.createElement('div');
  inner.style.maxWidth = '90vw';
  inner.style.maxHeight = '80vh';
  inner.style.overflowY = 'auto';
  inner.style.padding = '30px';
  inner.style.background = '#222';
  inner.style.borderRadius = '10px';
  inner.style.color = '#fff';
  inner.style.fontSize = '24px';
  inner.style.textAlign = 'center';
  inner.style.whiteSpace = 'pre-wrap';
  inner.innerText = message;

  popup.appendChild(inner);
  popup.addEventListener('click', () => popup.remove());
  document.body.appendChild(popup);
}

// Форматировать стих как: стих + перенос строки + ссылка


</script>


</body>
</html>